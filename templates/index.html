<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ ì„¸ê³„ ê¸°í›„ & ê±´ì¶• ì „ë¬¸ ë¶„ì„ ì‹œìŠ¤í…œ (ê°•í™”íŒ)</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin: 15px 0;
            line-height: 1.6;
        }

        .badge {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 25px;
            font-size: 0.9em;
            margin: 6px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .controls {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: flex;
            gap: 25px;
            align-items: center;
            flex-wrap: wrap;
        }

        .language-selector {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .language-selector label {
            font-weight: 600;
            color: #333;
        }

        .language-selector button {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 15px;
        }

        .language-selector button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .language-selector button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #764ba2;
        }

        .search-box {
            flex: 1;
            min-width: 350px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 22px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 25px;
        }

        .map-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        #map {
            height: 650px;
            border-radius: 15px;
        }

        .info-container {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            max-height: 700px;
            overflow-y: auto;
        }

        .info-container::-webkit-scrollbar {
            width: 12px;
        }

        .info-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        .info-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .info-placeholder {
            text-align: center;
            color: #999;
            padding: 100px 30px;
        }

        .info-placeholder i {
            font-size: 90px;
            margin-bottom: 25px;
            color: #ddd;
        }

        .loading {
            text-align: center;
            padding: 50px;
        }

        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-progress {
            margin: 30px 0;
            text-align: left;
        }

        .progress-item {
            padding: 15px 20px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #ddd;
            transition: all 0.4s;
            font-size: 15px;
        }

        .progress-item.active {
            border-left-color: #667eea;
            background: #e7f0ff;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .progress-item.done {
            border-left-color: #28a745;
            background: #d4edda;
            font-weight: 600;
        }

        .region-info {
            animation: fadeIn 0.7s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .region-header {
            border-bottom: 5px solid #667eea;
            padding-bottom: 25px;
            margin-bottom: 35px;
        }

        .region-title {
            color: #667eea;
            font-size: 2.6em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .weather-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 22px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.95em;
            opacity: 0.95;
            font-weight: 500;
        }

        .image-section {
            margin: 35px 0;
        }

        .image-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .tab-button {
            padding: 12px 28px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            font-size: 15px;
        }

        .tab-button:hover {
            background: #f0f4ff;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #764ba2;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .gallery-card {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.4s;
            cursor: pointer;
            background: white;
        }

        .gallery-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .gallery-card img {
            width: 100%;
            height: 240px;
            object-fit: cover;
        }

        .gallery-info {
            padding: 18px;
            background: white;
        }

        .gallery-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            font-size: 1em;
            line-height: 1.4;
        }

        .gallery-source {
            color: #999;
            font-size: 0.85em;
        }

        .gallery-type {
            display: inline-block;
            padding: 4px 12px;
            background: #e7f0ff;
            color: #667eea;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-top: 8px;
        }

        .no-images {
            text-align: center;
            padding: 50px;
            background: #fff3cd;
            border: 3px dashed #ffc107;
            border-radius: 15px;
            color: #856404;
        }

        .section-card {
            margin: 30px 0;
            padding: 35px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 8px solid #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .section-card h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 22px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }

        .section-card p {
            color: #444;
            line-height: 2.1;
            font-size: 1.1em;
            text-align: justify;
            white-space: pre-wrap;
        }

        .examples-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 25px;
            border: 2px solid #e7f0ff;
        }

        .examples-box h4 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .examples-box ul {
            list-style: none;
            padding: 0;
        }

        .examples-box li {
            padding: 16px 20px;
            margin: 12px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            font-size: 1.08em;
            line-height: 1.7;
            transition: all 0.3s;
        }

        .examples-box li:hover {
            background: #e7f0ff;
            transform: translateX(5px);
        }

        .examples-box li:before {
            content: "ğŸ›ï¸ ";
            margin-right: 12px;
            font-size: 1.2em;
        }

        .simple-explanation-box {
            background: linear-gradient(135deg, #e7f0ff 0%, #f0e7ff 100%);
            padding: 35px;
            border-radius: 15px;
            margin: 30px 0;
            border: 3px solid #667eea;
        }

        .simple-explanation-box h3 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .simple-explanation-box p {
            color: #333;
            line-height: 2.2;
            font-size: 1.12em;
            white-space: pre-wrap;
        }

        .data-sources {
            margin-top: 35px;
            padding: 25px;
            background: #e7f0ff;
            border-radius: 12px;
            border: 2px solid #b3d7ff;
        }

        .data-sources h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .source-badge {
            display: inline-block;
            padding: 8px 18px;
            margin: 6px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 0.9em;
            color: #667eea;
            font-weight: 600;
        }

        .timestamp {
            text-align: right;
            color: #999;
            font-size: 0.95em;
            margin-top: 35px;
            padding-top: 25px;
            border-top: 3px solid #e0e0e0;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 30px;
            border-radius: 12px;
            border-left: 6px solid #c33;
        }

        .divider {
            height: 4px;
            background: linear-gradient(to right, #667eea, #764ba2);
            margin: 40px 0;
            border-radius: 10px;
        }

        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-globe-americas"></i> ì„¸ê³„ ê¸°í›„ & ê±´ì¶• ì „ë¬¸ ë¶„ì„ ì‹œìŠ¤í…œ</h1>
            <p class="subtitle">ğŸŒ¡ï¸ ì‹¤ì‹œê°„ ë°ì´í„° + ğŸ¤– AI ê³¼í•™ì  ë¶„ì„ + ğŸ–¼ï¸ ì‹¤ì œ ì´ë¯¸ì§€ + ğŸ’¡ ì‰¬ìš´ ì„¤ëª…</p>
            <div style="margin-top: 20px;">
                <span class="badge"><i class="fas fa-database"></i> ì‹¤ì‹œê°„ ê¸°ìƒ ë°ì´í„°</span>
                <span class="badge"><i class="fas fa-robot"></i> AI ì´ˆê°•ë ¥ ë¶„ì„</span>
                <span class="badge"><i class="fas fa-images"></i> í™˜ê²½+ê±´ì¶• ì´ë¯¸ì§€</span>
                <span class="badge"><i class="fas fa-book-open"></i> ìœ„í‚¤í”¼ë””ì•„</span>
                <span class="badge"><i class="fas fa-lightbulb"></i> ì‰¬ìš´ ì„¤ëª…</span>
            </div>
        </header>

        <div class="controls">
            <div class="language-selector">
                <label><i class="fas fa-language"></i> ì–¸ì–´:</label>
                <button id="lang-ko" class="active" onclick="setLanguage('ko')">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</button>
                <button id="lang-en" onclick="setLanguage('en')">English ğŸ‡ºğŸ‡¸</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="search-input" placeholder="ğŸ” ì§€ì—­ ê²€ìƒ‰ (ì˜ˆ: Seoul, Paris, Tokyo, Cairo, New York)">
            </div>
        </div>

        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
            </div>

            <div class="info-container">
                <div id="info-content" class="info-placeholder">
                    <i class="fas fa-map-marked-alt"></i>
                    <h2>ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                    <p style="font-size: 1.15em; margin: 20px 0;">ì§€ë„ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ê²€ìƒ‰í•˜ì—¬ ì „ë¬¸ ë¶„ì„ì„ í™•ì¸í•˜ì„¸ìš”</p>
                    <p style="color: #999; margin-top: 20px;">
                        âœ¨ ì‹¤ì‹œê°„ ê¸°í›„ + ìœ„í‚¤í”¼ë””ì•„ + AI ë¶„ì„ + ì´ë¯¸ì§€ + ì‰¬ìš´ ì„¤ëª…
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map;
        let currentLanguage = 'ko';
        let currentImageTab = 'all';

        function initMap() {
            map = L.map('map').setView([25, 10], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap',
                maxZoom: 18
            }).addTo(map);

            map.on('click', function(e) {
                handleMapClick(e.latlng);
            });

            addCityMarkers();
        }

        function addCityMarkers() {
            const cities = [
                { name: 'ì„œìš¸', name_en: 'Seoul', lat: 37.5665, lng: 126.9780 },
                { name: 'ë„ì¿„', name_en: 'Tokyo', lat: 35.6762, lng: 139.6503 },
                { name: 'ë² ì´ì§•', name_en: 'Beijing', lat: 39.9042, lng: 116.4074 },
                { name: 'ë°©ì½•', name_en: 'Bangkok', lat: 13.7563, lng: 100.5018 },
                { name: 'ë‰´ìš•', name_en: 'New York', lat: 40.7128, lng: -74.0060 },
                { name: 'ëŸ°ë˜', name_en: 'London', lat: 51.5074, lng: -0.1278 },
                { name: 'íŒŒë¦¬', name_en: 'Paris', lat: 48.8566, lng: 2.3522 },
                { name: 'ì¹´ì´ë¡œ', name_en: 'Cairo', lat: 30.0444, lng: 31.2357 },
                { name: 'ì‹œë“œë‹ˆ', name_en: 'Sydney', lat: -33.8688, lng: 151.2093 },
                { name: 'ë¡œë§ˆ', name_en: 'Rome', lat: 41.9028, lng: 12.4964 },
                { name: 'ì´ìŠ¤íƒ„ë¶ˆ', name_en: 'Istanbul', lat: 41.0082, lng: 28.9784 },
                { name: 'ë¸ë¦¬', name_en: 'Delhi', lat: 28.6139, lng: 77.2090 },
                { name: 'ìƒí•˜ì´', name_en: 'Shanghai', lat: 31.2304, lng: 121.4737 },
                { name: 'ëª¨ìŠ¤í¬ë°”', name_en: 'Moscow', lat: 55.7558, lng: 37.6173 },
                { name: 'ë‘ë°”ì´', name_en: 'Dubai', lat: 25.2048, lng: 55.2708 }
            ];

            cities.forEach(city => {
                L.marker([city.lat, city.lng])
                    .addTo(map)
                    .bindPopup(`
                        <div style="text-align: center; padding: 10px;">
                            <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.3em;">${currentLanguage === 'ko' ? city.name : city.name_en}</h3>
                            <button onclick="getRegionInfo(${city.lat}, ${city.lng}, '${currentLanguage === 'ko' ? city.name : city.name_en}')" 
                                    style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px;">
                                ${currentLanguage === 'ko' ? 'ğŸ“Š ì „ë¬¸ ë¶„ì„ ë³´ê¸°' : 'ğŸ“Š View Analysis'}
                            </button>
                        </div>
                    `);
            });
        }

        async function handleMapClick(latlng) {
            const regionName = await getRegionName(latlng.lat, latlng.lng);
            getRegionInfo(latlng.lat, latlng.lng, regionName);
        }

        async function getRegionName(lat, lng) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=${currentLanguage}`
                );
                const data = await response.json();
                return data.address.city || data.address.town || data.address.county || data.address.state || 'Unknown';
            } catch {
                return 'Unknown Location';
            }
        }

        async function getRegionInfo(lat, lng, regionName) {
            const infoContent = document.getElementById('info-content');
            
            infoContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <h2 style="color: #667eea; margin-bottom: 20px; font-size: 2em;">
                        ${currentLanguage === 'ko' ? 'ğŸ¤– AI ì „ë¬¸ ë¶„ì„ ì§„í–‰ ì¤‘...' : 'ğŸ¤– AI Professional Analysis...'}
                    </h2>
                    <p style="color: #666; margin-bottom: 30px; font-size: 1.1em;">
                        ${currentLanguage === 'ko' ? 'ì‹¤ì œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  AIê°€ ê³¼í•™ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤' : 'Collecting real data and AI analyzing scientifically'}
                    </p>
                    <div class="loading-progress">
                        <div class="progress-item active" id="step1">
                            <i class="fas fa-spinner fa-spin"></i> ${currentLanguage === 'ko' ? 'ì‹¤ì‹œê°„ ê¸°ìƒ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...' : 'Collecting weather data...'}
                        </div>
                        <div class="progress-item" id="step2">
                            <i class="fas fa-clock"></i> ${currentLanguage === 'ko' ? 'ìœ„í‚¤í”¼ë””ì•„ ì •ë³´ ìˆ˜ì§‘ ì¤‘...' : 'Collecting Wikipedia data...'}
                        </div>
                        <div class="progress-item" id="step3">
                            <i class="fas fa-clock"></i> ${currentLanguage === 'ko' ? 'AI ì´ˆê°•ë ¥ ì „ë¬¸ ë¶„ì„ ì¤‘... (60-120ì´ˆ ì†Œìš”)' : 'AI analysis... (60-120 sec)'}
                        </div>
                        <div class="progress-item" id="step4">
                            <i class="fas fa-clock"></i> ${currentLanguage === 'ko' ? 'í™˜ê²½ + ê±´ì¶•ë¬¼ ì´ë¯¸ì§€ ê²€ìƒ‰ ì¤‘...' : 'Searching images...'}
                        </div>
                        <div class="progress-item" id="step5">
                            <i class="fas fa-clock"></i> ${currentLanguage === 'ko' ? 'ìƒì„¸ ë³´ê³ ì„œ ìƒì„± ì¤‘...' : 'Generating report...'}
                        </div>
                    </div>
                    <p style="margin-top: 30px; color: #999; font-size: 1em;">
                        â±ï¸ ${currentLanguage === 'ko' ? 'ì˜ˆìƒ ì‹œê°„: 60-150ì´ˆ (AI ë¶„ì„ í¬í•¨)' : 'Estimated: 60-150 seconds'}
                    </p>
                </div>
            `;

            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                if (stepIndex > 0) {
                    const prevStep = document.getElementById(steps[stepIndex - 1]);
                    if (prevStep) {
                        prevStep.className = 'progress-item done';
                        prevStep.innerHTML = prevStep.innerHTML.replace('fa-spin', '').replace('fa-spinner', 'fa-check').replace('fa-clock', 'fa-check');
                    }
                }
                
                if (stepIndex < steps.length) {
                    const currentStep = document.getElementById(steps[stepIndex]);
                    if (currentStep) {
                        currentStep.className = 'progress-item active';
                        currentStep.innerHTML = currentStep.innerHTML.replace('fa-clock', 'fa-spinner fa-spin');
                    }
                    stepIndex++;
                } else {
                    clearInterval(stepInterval);
                }
            }, 10000);

            try {
                const response = await fetch('/api/region-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        region: regionName,
                        lat: lat,
                        lng: lng,
                        language: currentLanguage
                    })
                });

                clearInterval(stepInterval);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ì •ë³´ ìˆ˜ì§‘ ì‹¤íŒ¨');
                }

                const data = await response.json();
                displayRegionInfo(data);

            } catch (error) {
                clearInterval(stepInterval);
                infoContent.innerHTML = `
                    <div class="error">
                        <h3><i class="fas fa-exclamation-triangle"></i> ì˜¤ë¥˜ ë°œìƒ</h3>
                        <p style="font-size: 1.1em; margin: 15px 0;">${error.message}</p>
                        <p style="margin-top: 20px; font-size: 1em; line-height: 1.8;">
                            í™•ì¸ ì‚¬í•­:<br>
                            1ï¸âƒ£ ì„œë²„ ì‹¤í–‰ í™•ì¸ (í„°ë¯¸ë„ì— Flask ë©”ì‹œì§€)<br>
                            2ï¸âƒ£ .env íŒŒì¼ì˜ HF_API_KEY í™•ì¸<br>
                            3ï¸âƒ£ ì¸í„°ë„· ì—°ê²° í™•ì¸<br>
                            4ï¸âƒ£ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
                        </p>
                    </div>
                `;
            }
        }

        function displayRegionInfo(data) {
            const info = data.information;
            let html = `
                <div class="region-info">
                    <div class="region-header">
                        <h2 class="region-title">
                            <i class="fas fa-map-marker-alt"></i> ${data.region}
                        </h2>
                        <p style="color: #999; font-size: 1em; margin-top: 10px;">
                            <i class="fas fa-compass"></i> 
                            ìœ„ë„ ${data.coordinates.lat.toFixed(4)}Â°, ê²½ë„ ${data.coordinates.lng.toFixed(4)}Â°
                        </p>
            `;

            if (data.current_weather) {
                const w = data.current_weather;
                html += `
                    <div class="weather-stats">
                        <div class="stat-card">
                            <div class="stat-value">${w.temperature}Â°C</div>
                            <div class="stat-label">í˜„ì¬ ê¸°ì˜¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${w.humidity}%</div>
                            <div class="stat-label">ìƒëŒ€ ìŠµë„</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${w.wind_speed} km/h</div>
                            <div class="stat-label">í’ì†</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${w.precipitation} mm</div><div class="stat-label">ê°•ìˆ˜ëŸ‰</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${w.apparent_temperature}Â°C</div>
                            <div class="stat-label">ì²´ê° ì˜¨ë„</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${w.pressure} hPa</div>
                            <div class="stat-label">ê¸°ì••</div>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;

            // ì´ë¯¸ì§€ ì„¹ì…˜ (íƒ­ìœ¼ë¡œ êµ¬ë¶„)
            if (data.has_images && data.images.all.length > 0) {
                const allImages = data.images.all;
                const archImages = data.images.architecture;
                const envImages = data.images.environment;

                html += `
                    <div class="image-section">
                        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.6em;">
                            <i class="fas fa-camera-retro"></i> ì‹¤ì œ ì´ë¯¸ì§€ (ì´ ${allImages.length}ê°œ)
                        </h3>
                        <div class="image-tabs">
                            <button class="tab-button active" onclick="switchImageTab('all', ${JSON.stringify(allImages).replace(/"/g, '&quot;')})">
                                ì „ì²´ (${allImages.length})
                            </button>
                            <button class="tab-button" onclick="switchImageTab('architecture', ${JSON.stringify(archImages).replace(/"/g, '&quot;')})">
                                ğŸ›ï¸ ê±´ì¶•ë¬¼ (${archImages.length})
                            </button>
                            <button class="tab-button" onclick="switchImageTab('environment', ${JSON.stringify(envImages).replace(/"/g, '&quot;')})">
                                ğŸŒ„ í™˜ê²½ (${envImages.length})
                            </button>
                        </div>
                        <div class="image-gallery" id="image-gallery">
                `;
                
                allImages.forEach(img => {
                    const typeLabel = img.type === 'architecture' ? 'ê±´ì¶•ë¬¼' : img.type === 'environment' ? 'í™˜ê²½' : 'ì¼ë°˜';
                    html += `
                        <div class="gallery-card" onclick="window.open('${img.url}', '_blank')">
                            <img src="${img.url}" alt="${img.title}" 
                                 onerror="this.src='https://via.placeholder.com/400x300?text=Image+Unavailable'">
                            <div class="gallery-info">
                                <div class="gallery-title">${img.title}</div>
                                <div class="gallery-source">${img.source}</div>
                                <span class="gallery-type">${typeLabel}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            } else {
                html += `
                    <div class="no-images">
                        <i class="fas fa-image" style="font-size: 60px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h4 style="font-size: 1.3em;">ì´ë¯¸ì§€ ì—†ìŒ</h4>
                        <p style="margin-top: 15px; font-size: 1.05em;">Wikimedia Commonsì—ì„œ ì´ ì§€ì—­ì˜ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }

            html += `<div class="divider"></div>`;

            // ê¸°í›„ íŠ¹ì„±
            html += `
                <div class="section-card">
                    <h3><i class="fas fa-cloud-sun"></i> 1. ê¸°í›„ íŠ¹ì„± ì „ë¬¸ ë¶„ì„</h3>
                    <p>${info.climate || 'ì •ë³´ ìˆ˜ì§‘ ì¤‘...'}</p>
                </div>
            `;

            // ìì—° í™˜ê²½
            html += `
                <div class="section-card">
                    <h3><i class="fas fa-mountain"></i> 2. ìì—° í™˜ê²½ ì§€ë¦¬í•™ì  ë¶„ì„</h3>
                    <p>${info.environment || 'ì •ë³´ ìˆ˜ì§‘ ì¤‘...'}</p>
                </div>
            `;

            html += `<div class="divider"></div>`;

            // ì „í†µ ê±´ì¶•
            html += `
                <div class="section-card">
                    <h3><i class="fas fa-building"></i> 3. ì „í†µ ê±´ì¶• ì–‘ì‹ ê±´ì¶•í•™ì  ë¶„ì„</h3>
                    <p>${info.architecture || 'ì •ë³´ ìˆ˜ì§‘ ì¤‘...'}</p>
            `;

            // ê±´ì¶•ë¬¼ ì˜ˆì‹œ
            if (info.building_examples && info.building_examples.length > 0) {
                html += `
                    <div class="examples-box">
                        <h4><i class="fas fa-landmark"></i> ëŒ€í‘œ ê±´ì¶•ë¬¼ ì˜ˆì‹œ</h4>
                        <ul>
                `;
                info.building_examples.forEach(ex => {
                    html += `<li>${ex}</li>`;
                });
                html += `</ul></div>`;
            }

            html += `</div>`;

            // ê¸°í›„ ì ì‘
            html += `
                <div class="section-card">
                    <h3><i class="fas fa-tools"></i> 4. ê¸°í›„ ì ì‘ ê±´ì¶• í™˜ê²½ê³µí•™ì  ë¶„ì„</h3>
                    <p>${info.adaptation || 'ì •ë³´ ìˆ˜ì§‘ ì¤‘...'}</p>
                </div>
            `;

            html += `<div class="divider"></div>`;

            // ì‰¬ìš´ ì„¤ëª…
            if (info.simple_explanation) {
                html += `
                    <div class="simple-explanation-box">
                        <h3><i class="fas fa-lightbulb"></i> 5. ì‰¬ìš´ ì¶”ê°€ ì„¤ëª… (ì „ë¬¸ ìš©ì–´ í’€ì´)</h3>
                        <p>${info.simple_explanation}</p>
                    </div>
                `;
            }

            // ë°ì´í„° ì¶œì²˜
            if (data.data_sources) {
                html += `
                    <div class="data-sources">
                        <h4><i class="fas fa-database"></i> ë°ì´í„° ì¶œì²˜ ë° ë¶„ì„ ë°©ë²•</h4>
                        ${data.data_sources.wikipedia ? '<span class="source-badge">ğŸ“š Wikipedia API</span>' : ''}
                        ${data.data_sources.weather_api ? '<span class="source-badge">ğŸŒ¡ï¸ Open-Meteo API</span>' : ''}
                        ${data.data_sources.ai_analysis ? '<span class="source-badge">ğŸ¤– AI ë¶„ì„ (Mistral Mixtral-8x7B)</span>' : ''}
                        <span class="source-badge">ğŸ“¸ Wikimedia Commons (${data.image_count.total}ê°œ)</span>
                    </div>
                `;
            }

            html += `
                <div class="timestamp">
                    <i class="fas fa-clock"></i> ìƒì„± ì‹œê°„: ${data.generated_at}
                </div>
            </div>
            `;

            document.getElementById('info-content').innerHTML = html;
        }

        function switchImageTab(tab, images) {
            currentImageTab = tab;
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ì—…ë°ì´íŠ¸
            const gallery = document.getElementById('image-gallery');
            let html = '';
            
            images.forEach(img => {
                const typeLabel = img.type === 'architecture' ? 'ê±´ì¶•ë¬¼' : img.type === 'environment' ? 'í™˜ê²½' : 'ì¼ë°˜';
                html += `
                    <div class="gallery-card" onclick="window.open('${img.url}', '_blank')">
                        <img src="${img.url}" alt="${img.title}" 
                             onerror="this.src='https://via.placeholder.com/400x300?text=Image+Unavailable'">
                        <div class="gallery-info">
                            <div class="gallery-title">${img.title}</div>
                            <div class="gallery-source">${img.source}</div>
                            <span class="gallery-type">${typeLabel}</span>
                        </div>
                    </div>
                `;
            });
            
            gallery.innerHTML = html;
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('lang-ko').classList.toggle('active', lang === 'ko');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            const searchInput = document.getElementById('search-input');
            searchInput.placeholder = lang === 'ko' 
                ? 'ğŸ” ì§€ì—­ ê²€ìƒ‰ (ì˜ˆ: Seoul, Paris, Tokyo, Cairo)'
                : 'ğŸ” Search region (e.g., Seoul, Paris, Tokyo, Cairo)';
        }

        document.getElementById('search-input').addEventListener('keypress', async function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                await searchLocation(this.value.trim());
            }
        });

        async function searchLocation(query) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&accept-language=${currentLanguage}&limit=1`
                );
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const location = data[0];
                    const lat = parseFloat(location.lat);
                    const lng = parseFloat(location.lon);
                    
                    map.setView([lat, lng], 10);
                    
                    L.marker([lat, lng])
                        .addTo(map)
                        .bindPopup(`
                            <div style="text-align: center; padding: 10px;">
                                <h3 style="color: #667eea; margin-bottom: 15px;">${location.display_name}</h3>
                                <button onclick="getRegionInfo(${lat}, ${lng}, '${query}')" 
                                        style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                    ${currentLanguage === 'ko' ? 'ğŸ“Š ì „ë¬¸ ë¶„ì„ ë³´ê¸°' : 'ğŸ“Š View Analysis'}
                                </button>
                            </div>
                        `)
                        .openPopup();
                    
                    await getRegionInfo(lat, lng, query);
                } else {
                    alert(currentLanguage === 'ko' 
                        ? 'ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' 
                        : 'Location not found.');
                }
            } catch (error) {
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                alert(currentLanguage === 'ko' 
                    ? 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ' 
                    : 'Search error');
            }
        }

        window.onload = function() {
            initMap();
        };
    </script>
</body>
</html>